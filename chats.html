<!DOCTYPE html>
<html>
<head>
  <title>Chat</title>
  <link rel="stylesheet" href="chat.css">
</head>
<body>

<h2>Public Chat</h2>

<input type="text" id="username" placeholder="Enter your name">
<br><br>

<input type="text" id="message" placeholder="Type message">
<button onclick="sendMessage()">Send</button>
<button onclick="adminLogin()">Admin Login</button>

<div id="chatBox"></div>
<a href="index.html">⬅ Back to Home</a>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCy1reCJaNB1aG3UXT8LPpRR-CgQXXAdZk",
  authDomain: "mychatapp-8ee22.firebaseapp.com",
  databaseURL: "https://mychatapp-8ee22-default-rtdb.firebaseio.com",
  projectId: "mychatapp-8ee22",
  storageBucket: "mychatapp-8ee22.firebasestorage.app",
  messagingSenderId: "844615179260",
  appId: "1:844615179260:web:2f197d1d330448c6dff079"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database().ref("chats");

var isAdmin = false;

// Admin login
function adminLogin(){
  var pass = prompt("Enter admin password:");
  if(pass === "Rudra@12"){
    isAdmin = true;
    alert("Admin mode ON");

    document.getElementById("chatBox").innerHTML = "";
    showMessages();
  } else {
    alert("Wrong password");
  }
}

function sendMessage() {
  var name = document.getElementById("username").value;
  var msg = document.getElementById("message").value;

  if(name == "" || msg == ""){
    alert("Name and message required");
    return;
  }

  db.push({
    user: name,
    message: msg
  });

  document.getElementById("message").value = "";
}

// Show messages
function showMessages(){
  db.off(); // purana listener remove
  db.on("child_added", function(snapshot){
    var data = snapshot.val();
    var key = snapshot.key;
    var chatBox = document.getElementById("chatBox");

    let html = `<p id="${key}"><b>${data.user}:</b> ${data.message}`;

    if(isAdmin){
      html += ` <button onclick="deleteMsg('${key}')">❌</button>`;
    }

    html += `</p>`;
    chatBox.innerHTML += html;
  });
}

// Delete message
function deleteMsg(key){
  if(isAdmin){
    firebase.database().ref("chats/" + key).remove();
    document.getElementById(key).remove();
  }
}

// normal user ke liye messages load
showMessages();
</script>

</body>
</html>
